<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCAR - Ficha de Investigacao</title>
    <link rel="stylesheet" href="https://cdn.squeleton.dev/squeleton.v4.min.css">
    <script src="https://cdn.squeleton.dev/squeleton-main.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;500;600;700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root {
            --blood: #8B0000;
            --blood-bright: #DC143C;
            --blood-glow: #FF4444;
            --dark: #0a0a0a;
            --text: #f5f5f5;
            --text-muted: #999;
            --border: #333;
            --gold: #D4AF37;
            --blue: #5DADE2;
            --green: #27ae60;
        }

        @media print {
            body { background: white !important; }
            .no-print { display: none !important; }
            .ficha-page { box-shadow: none !important; border: 2px solid #333 !important; }
            .ficha-page * { color: #222 !important; }
            .page-bg { opacity: 0.08 !important; }
            input, textarea { border-color: #999 !important; background: transparent !important; color: #222 !important; }
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.5;
        }

        /* === TOOLBAR === */
        .toolbar {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 100;
            background: rgba(10,10,10,0.95);
            backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--blood);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .toolbar-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--blood-bright);
            letter-spacing: 3px;
        }

        .toolbar-actions { display: flex; gap: 8px; }

        .btn-action {
            background: var(--blood);
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1.5px;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .btn-action:hover {
            background: var(--blood-bright);
            box-shadow: 0 0 15px rgba(220,20,60,0.4);
        }

        .btn-action.outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
        }

        .btn-action.outline:hover {
            border-color: var(--blood-bright);
            color: var(--blood-bright);
        }

        /* === FICHA === */
        .ficha-wrapper {
            max-width: 750px;
            margin: 80px auto 40px;
            padding: 0 15px;
        }

        .ficha-page {
            position: relative;
            background: #1a1410;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6), 0 0 40px rgba(139,0,0,0.15);
            border: 1px solid rgba(139,0,0,0.3);
        }

        .page-bg {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('../assets/images/livro 1.jpeg');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .ficha-content {
            position: relative;
            z-index: 1;
            padding: 40px 35px;
        }

        @media (max-width: 640px) {
            .ficha-content { padding: 25px 15px; }
        }

        /* === FICHA TITLE === */
        .ficha-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            color: var(--blood-bright);
            text-align: center;
            letter-spacing: 8px;
            text-shadow: 0 0 30px rgba(220,20,60,0.4), 0 3px 0 #5a0000;
            margin-bottom: 5px;
        }

        .ficha-subtitle {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-bottom: 25px;
        }

        /* === SECTIONS === */
        .secao {
            margin-bottom: 25px;
        }

        .secao-header {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--blood-bright);
            letter-spacing: 3px;
            text-transform: uppercase;
            padding: 6px 12px;
            background: linear-gradient(90deg, rgba(139,0,0,0.25), transparent);
            border-left: 3px solid var(--blood-bright);
            margin-bottom: 15px;
        }

        .secao-divider {
            height: 1px;
            background: linear-gradient(90deg, var(--blood), transparent);
            margin: 20px 0;
        }

        /* === INPUTS === */
        .field-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .field-label {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--gold);
            letter-spacing: 1.5px;
            min-width: 80px;
            white-space: nowrap;
        }

        .field-input {
            flex: 1;
            min-width: 80px;
            background: rgba(0,0,0,0.3);
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.15);
            color: var(--text);
            padding: 6px 8px;
            font-family: 'Special Elite', monospace;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s;
            border-radius: 0;
        }

        .field-input:focus {
            border-bottom-color: var(--blood-bright);
        }

        .field-input::placeholder {
            color: rgba(255,255,255,0.15);
            font-family: 'Roboto', sans-serif;
            font-size: 0.75rem;
        }

        .field-input.small {
            max-width: 60px;
            text-align: center;
        }

        .field-input.medium {
            max-width: 120px;
        }

        /* === ATRIBUTOS GRID === */
        .attr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px 20px;
        }

        @media (max-width: 640px) {
            .attr-grid { grid-template-columns: 1fr; }
        }

        .attr-category {
            margin-bottom: 5px;
        }

        .attr-cat-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.85rem;
            color: var(--blood-bright);
            letter-spacing: 2px;
            text-align: center;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(220,20,60,0.2);
        }

        .attr-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .attr-name {
            font-size: 0.85rem;
            color: #ccc;
        }

        .attr-value {
            width: 36px;
            height: 36px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: var(--text);
            text-align: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            outline: none;
            transition: all 0.3s;
        }

        .attr-value:focus {
            border-color: var(--blood-bright);
            box-shadow: 0 0 10px rgba(220,20,60,0.2);
        }

        /* === STATUS === */
        .stress-bar {
            display: flex;
            gap: 4px;
            margin: 8px 0;
        }

        .stress-box {
            width: 28px;
            height: 28px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stress-box.filled {
            background: linear-gradient(135deg, var(--blood), var(--blood-bright));
            border-color: var(--blood-bright);
            box-shadow: 0 0 8px rgba(220,20,60,0.3);
        }

        .stress-box:hover {
            border-color: var(--blood-bright);
            transform: scale(1.1);
        }

        /* === INJURIES === */
        .injury-section {
            margin: 8px 0;
        }

        .injury-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .injury-label {
            font-size: 0.85rem;
            min-width: 65px;
        }

        .injury-label.leve { color: var(--gold); }
        .injury-label.grave { color: #e67e22; }
        .injury-label.critica { color: var(--blood-bright); }

        .injury-slots {
            display: flex;
            gap: 5px;
        }

        .injury-slot {
            width: 24px;
            height: 24px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .injury-slot.filled.leve {
            background: var(--gold);
            border-color: var(--gold);
        }

        .injury-slot.filled.grave {
            background: #e67e22;
            border-color: #e67e22;
        }

        .injury-slot.filled.critica {
            background: var(--blood-bright);
            border-color: var(--blood-bright);
            box-shadow: 0 0 10px rgba(220,20,60,0.4);
        }

        .injury-slot:hover { transform: scale(1.15); }

        .injury-counter {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-left: 5px;
        }

        /* === EQUIPMENT === */
        .equip-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .equip-bullet {
            width: 6px;
            height: 6px;
            background: var(--blood);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* === PHOTO === */
        .photo-frame {
            width: 100px;
            height: 120px;
            background: rgba(0,0,0,0.4);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            transition: border-color 0.3s;
            position: relative;
        }

        .photo-frame:hover {
            border-color: var(--blood-bright);
        }

        .photo-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-placeholder {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-align: center;
            padding: 5px;
        }

        .photo-input {
            display: none;
        }

        /* === PM COUNTER === */
        .pm-display {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pm-box {
            width: 32px;
            height: 32px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(93,173,226,0.3);
            border-radius: 4px;
            color: var(--blue);
            text-align: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            outline: none;
        }

        .pm-box:focus {
            border-color: var(--blue);
            box-shadow: 0 0 10px rgba(93,173,226,0.2);
        }

        /* === CLASSIFIED STAMP === */
        .classified-stamp {
            position: absolute;
            bottom: 30px;
            right: 30px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            color: var(--blood-bright);
            letter-spacing: 5px;
            border: 3px solid var(--blood-bright);
            padding: 5px 20px;
            transform: rotate(-8deg);
            opacity: 0.5;
        }

        /* === TEXTAREA === */
        .notes-area {
            width: 100%;
            min-height: 60px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 6px;
            color: var(--text);
            padding: 10px;
            font-family: 'Special Elite', monospace;
            font-size: 0.9rem;
            outline: none;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .notes-area:focus {
            border-color: var(--blood-bright);
        }
    </style>
</head>
<body>

    <!-- TOOLBAR -->
    <div class="toolbar no-print">
        <a href="../index.html" class="toolbar-title" style="text-decoration:none;">SCAR</a>
        <span class="toolbar-title">Ficha de Investigacao</span>
        <div class="toolbar-actions">
            <button class="btn-action outline" onclick="clearForm()">Limpar</button>
            <button class="btn-action outline" onclick="saveToLocal()">Salvar</button>
            <button class="btn-action outline" onclick="loadFromLocal()">Carregar</button>
            <button class="btn-action" onclick="window.print()">PDF</button>
        </div>
    </div>

    <!-- FICHA -->
    <div class="ficha-wrapper">
        <div class="ficha-page">
            <div class="page-bg"></div>
            <div class="ficha-content">

                <h1 class="ficha-title">Ficha de Investigacao</h1>
                <p class="ficha-subtitle">SCAR &mdash; Sacrificial Contract &amp; Risk</p>

                <!-- SECAO 1: IDENTIDADE -->
                <div class="secao">
                    <div class="secao-header">Secao 1: Identidade</div>

                    <div style="display:flex;gap:20px;flex-wrap:wrap;">
                        <div style="flex:1;min-width:250px;">
                            <div class="field-row">
                                <span class="field-label">Nome:</span>
                                <input type="text" class="field-input" id="nome" placeholder="Nome do personagem">
                            </div>
                            <div class="field-row">
                                <span class="field-label">Idade:</span>
                                <input type="text" class="field-input small" id="idade" placeholder="--">
                                <span class="field-label">Tipo:</span>
                                <select class="field-input medium" id="tipo" style="font-family:'Roboto',sans-serif;font-size:0.85rem;">
                                    <option value="">Selecionar...</option>
                                    <option value="humano">Humano</option>
                                    <option value="infernal">Infernal</option>
                                    <option value="hibrido">Hibrido</option>
                                    <option value="demonio">Demonio</option>
                                </select>
                            </div>
                            <div class="field-row">
                                <span class="field-label">Conceito:</span>
                                <input type="text" class="field-input" id="conceito" placeholder="Conceito do personagem">
                            </div>
                            <div class="field-row">
                                <span class="field-label">Ligacao:</span>
                                <input type="text" class="field-input" id="ligacao" placeholder="Ligacao com demonios">
                            </div>
                            <div class="field-row">
                                <span class="field-label">Falha Central:</span>
                                <input type="text" class="field-input" id="falha" placeholder="Sua falha central">
                            </div>
                        </div>
                        <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
                            <div class="photo-frame" onclick="document.getElementById('photoInput').click()">
                                <span class="photo-placeholder" id="photoPlaceholder">Clique para adicionar foto</span>
                                <img id="photoPreview" style="display:none;">
                            </div>
                            <input type="file" class="photo-input" id="photoInput" accept="image/*" onchange="loadPhoto(event)">
                            <div class="pm-display">
                                <span class="field-label" style="min-width:auto;color:var(--blue);">PM:</span>
                                <input type="number" class="pm-box" id="pm-atual" value="0" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="secao-divider"></div>

                <!-- SECAO 2: ATRIBUTOS -->
                <div class="secao">
                    <div class="secao-header">Secao 2: Atributos</div>

                    <div class="attr-grid">
                        <div class="attr-category">
                            <div class="attr-cat-title">Fisicos</div>
                            <div class="attr-row">
                                <span class="attr-name">Forca</span>
                                <input type="number" class="attr-value" id="forca" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Vigor</span>
                                <input type="number" class="attr-value" id="vigor" value="0" min="0" max="10" onchange="calcularStatus()">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Coordenacao</span>
                                <input type="number" class="attr-value" id="coordenacao" value="0" min="0" max="10">
                            </div>
                        </div>

                        <div class="attr-category">
                            <div class="attr-cat-title">Taticos</div>
                            <div class="attr-row">
                                <span class="attr-name">Malandragem</span>
                                <input type="number" class="attr-value" id="malandragem" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Tecnologia</span>
                                <input type="number" class="attr-value" id="tecnologia" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Percepcao</span>
                                <input type="number" class="attr-value" id="percepcao" value="0" min="0" max="10">
                            </div>
                        </div>

                        <div class="attr-category">
                            <div class="attr-cat-title">Mentais</div>
                            <div class="attr-row">
                                <span class="attr-name">Investigacao</span>
                                <input type="number" class="attr-value" id="investigacao" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Negociacao</span>
                                <input type="number" class="attr-value" id="negociacao" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Autoridade</span>
                                <input type="number" class="attr-value" id="autoridade" value="0" min="0" max="10">
                            </div>
                            <div class="attr-row">
                                <span class="attr-name">Vinculo</span>
                                <input type="number" class="attr-value" id="vinculo" value="0" min="0" max="10" onchange="calcularStatus()">
                            </div>
                        </div>
                    </div>

                    <div style="text-align:center;margin-top:10px;">
                        <span style="font-size:0.8rem;color:var(--text-muted);">Total de pontos: </span>
                        <span id="totalPontos" style="font-family:'Bebas Neue';font-size:1.1rem;color:var(--gold);">0</span>
                        <span style="font-size:0.8rem;color:var(--text-muted);"> / </span>
                        <span style="font-size:0.8rem;color:var(--text-muted);">Movimento: </span>
                        <span id="movimento" style="font-family:'Bebas Neue';font-size:1.1rem;color:var(--blue);">0m</span>
                    </div>
                </div>

                <div class="secao-divider"></div>

                <!-- SECAO 3: STATUS -->
                <div class="secao">
                    <div class="secao-header">Secao 3: Status</div>

                    <div style="display:flex;gap:30px;flex-wrap:wrap;">
                        <!-- STRESS -->
                        <div style="flex:1;min-width:200px;">
                            <div class="field-row" style="margin-bottom:5px;">
                                <span class="field-label">Stress</span>
                                <span style="font-size:0.8rem;color:var(--text-muted);">Atual: <strong id="stressAtual" style="color:var(--blood-bright);">0</strong> / Max: <strong id="stressMax" style="color:var(--text);">6</strong></span>
                            </div>
                            <div class="stress-bar" id="stressBar">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- INJURIES -->
                        <div style="flex:1;min-width:200px;">
                            <span class="field-label" style="display:block;margin-bottom:8px;">Injurias</span>
                            <div class="injury-section">
                                <div class="injury-row">
                                    <span class="injury-label leve">Leve</span>
                                    <div class="injury-slots" id="injLeve"></div>
                                    <span class="injury-counter" id="injLeveCount">0/2</span>
                                </div>
                                <div class="injury-row">
                                    <span class="injury-label grave">Grave</span>
                                    <div class="injury-slots" id="injGrave"></div>
                                    <span class="injury-counter" id="injGraveCount">0/1</span>
                                </div>
                                <div class="injury-row">
                                    <span class="injury-label critica">Critica</span>
                                    <div class="injury-slots" id="injCritica"></div>
                                    <span class="injury-counter" id="injCriticaCount">0/1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="secao-divider"></div>

                <!-- SECAO 4: EQUIPAMENTO -->
                <div class="secao">
                    <div class="secao-header">Secao 4: Equipamento e Marcas</div>

                    <div class="field-row">
                        <span class="field-label">Estilo Luta:</span>
                        <select class="field-input" id="estilo" style="font-family:'Roboto',sans-serif;font-size:0.85rem;">
                            <option value="">Selecionar estilo...</option>
                            <option value="boxe">Boxe</option>
                            <option value="livre">Estilo Livre</option>
                            <option value="espadachim">Espadachim</option>
                            <option value="atirador">Atirador</option>
                            <option value="luta-livre">Luta Livre</option>
                            <option value="judo">Judo</option>
                            <option value="spetsnaz">Spetsnaz</option>
                            <option value="pesadas">Armas Pesadas</option>
                            <option value="cacador">Cacador</option>
                            <option value="instintivo">Instintivo</option>
                            <option value="executor">Executor</option>
                            <option value="maos-guerra">Maos de Guerra</option>
                        </select>
                    </div>

                    <span class="field-label" style="display:block;margin:12px 0 8px;">Armamento:</span>
                    <div class="equip-item">
                        <span class="equip-bullet"></span>
                        <input type="text" class="field-input" id="arma1" placeholder="Arma / equipamento 1">
                    </div>
                    <div class="equip-item">
                        <span class="equip-bullet"></span>
                        <input type="text" class="field-input" id="arma2" placeholder="Arma / equipamento 2">
                    </div>
                    <div class="equip-item">
                        <span class="equip-bullet"></span>
                        <input type="text" class="field-input" id="arma3" placeholder="Arma / equipamento 3">
                    </div>

                    <span class="field-label" style="display:block;margin:12px 0 8px;">Aflicoes:</span>
                    <div class="equip-item">
                        <span class="equip-bullet" style="background:var(--blood-bright);"></span>
                        <input type="text" class="field-input" id="aflicao1" placeholder="Aflicao 1">
                    </div>
                    <div class="equip-item">
                        <span class="equip-bullet" style="background:var(--blood-bright);"></span>
                        <input type="text" class="field-input" id="aflicao2" placeholder="Aflicao 2">
                    </div>

                    <div class="field-row" style="margin-top:12px;">
                        <span class="field-label">Talisma:</span>
                        <input type="text" class="field-input" id="talisma" placeholder="Objeto ancora da humanidade">
                    </div>

                    <div class="field-row">
                        <span class="field-label">Marca Demonio:</span>
                        <input type="text" class="field-input" id="marca" placeholder="Marca do demonio (se houver)">
                    </div>
                </div>

                <div class="secao-divider"></div>

                <!-- SECAO 5: SONHOS E NOTAS -->
                <div class="secao">
                    <div class="secao-header">Secao 5: Sonhos e Anotacoes</div>

                    <span class="field-label" style="display:block;margin-bottom:8px;">Sonhos (Objetivos de Vida):</span>
                    <div class="equip-item">
                        <span class="equip-bullet" style="background:var(--gold);"></span>
                        <input type="text" class="field-input" id="sonho1" placeholder="Sonho 1">
                        <select class="field-input" style="max-width:100px;font-family:'Roboto';font-size:0.8rem;" id="sonho1tipo">
                            <option value="comum">Comum (3PM)</option>
                            <option value="pessoal">Pessoal (5PM)</option>
                            <option value="ambicioso">Ambicioso (8PM)</option>
                            <option value="tolo">Tolo (12PM)</option>
                        </select>
                    </div>
                    <div class="equip-item">
                        <span class="equip-bullet" style="background:var(--gold);"></span>
                        <input type="text" class="field-input" id="sonho2" placeholder="Sonho 2">
                        <select class="field-input" style="max-width:100px;font-family:'Roboto';font-size:0.8rem;" id="sonho2tipo">
                            <option value="comum">Comum (3PM)</option>
                            <option value="pessoal">Pessoal (5PM)</option>
                            <option value="ambicioso">Ambicioso (8PM)</option>
                            <option value="tolo">Tolo (12PM)</option>
                        </select>
                    </div>
                    <div class="equip-item">
                        <span class="equip-bullet" style="background:var(--gold);"></span>
                        <input type="text" class="field-input" id="sonho3" placeholder="Sonho 3">
                        <select class="field-input" style="max-width:100px;font-family:'Roboto';font-size:0.8rem;" id="sonho3tipo">
                            <option value="comum">Comum (3PM)</option>
                            <option value="pessoal">Pessoal (5PM)</option>
                            <option value="ambicioso">Ambicioso (8PM)</option>
                            <option value="tolo">Tolo (12PM)</option>
                        </select>
                    </div>

                    <span class="field-label" style="display:block;margin:12px 0 8px;">Anotacoes:</span>
                    <textarea class="notes-area" id="notas" placeholder="Anotacoes, historia de fundo, contratos, poderes..."></textarea>
                </div>

                <div class="classified-stamp">CLASSIFICADO</div>

            </div>
        </div>
    </div>

    <script src="https://cdn.squeleton.dev/squeleton-scripts.v4.min.js"></script>
    <script>
        // === STRESS SYSTEM ===
        let stressAtual = 0;
        let stressMax = 6;

        function calcularStatus() {
            const vigor = parseInt(document.getElementById('vigor').value) || 0;
            const vinculo = parseInt(document.getElementById('vinculo').value) || 0;
            const tipo = document.getElementById('tipo').value;
            const coord = parseInt(document.getElementById('coordenacao').value) || 0;

            stressMax = 6 + vigor + vinculo;
            if (tipo === 'humano') stressMax += 2;

            document.getElementById('stressMax').textContent = stressMax;
            renderStressBar();

            // Injury slots
            const leves = 2 + Math.floor(vigor / 2);
            const graves = 1 + Math.floor(vigor / 3);
            renderInjurySlots('injLeve', leves, 'leve');
            renderInjurySlots('injGrave', graves, 'grave');
            renderInjurySlots('injCritica', 1, 'critica');

            // Movement
            document.getElementById('movimento').textContent = (coord * 2) + 'm';

            // Total points
            calcularTotal();
        }

        function renderStressBar() {
            const bar = document.getElementById('stressBar');
            bar.innerHTML = '';
            for (let i = 0; i < stressMax; i++) {
                const box = document.createElement('div');
                box.className = 'stress-box' + (i < stressAtual ? ' filled' : '');
                box.onclick = function() {
                    if (i < stressAtual) {
                        stressAtual = i;
                    } else {
                        stressAtual = i + 1;
                    }
                    document.getElementById('stressAtual').textContent = stressAtual;
                    renderStressBar();
                };
                bar.appendChild(box);
            }
        }

        // === INJURY SYSTEM ===
        const injuries = { leve: 0, grave: 0, critica: 0 };

        function renderInjurySlots(containerId, max, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            if (injuries[type] > max) injuries[type] = max;

            for (let i = 0; i < max; i++) {
                const slot = document.createElement('div');
                slot.className = 'injury-slot' + (i < injuries[type] ? ' filled ' + type : '');
                slot.onclick = function() {
                    if (i < injuries[type]) {
                        injuries[type] = i;
                    } else {
                        injuries[type] = i + 1;
                    }
                    renderInjurySlots(containerId, max, type);
                };
                container.appendChild(slot);
            }

            document.getElementById(containerId + 'Count').textContent = injuries[type] + '/' + max;
        }

        // === TOTAL POINTS ===
        function calcularTotal() {
            const ids = ['forca','vigor','coordenacao','malandragem','tecnologia','percepcao','investigacao','negociacao','autoridade','vinculo'];
            let total = 0;
            ids.forEach(function(id) {
                total += parseInt(document.getElementById(id).value) || 0;
            });
            document.getElementById('totalPontos').textContent = total;
        }

        // All attribute inputs trigger recalc
        document.querySelectorAll('.attr-value').forEach(function(input) {
            input.addEventListener('change', calcularStatus);
            input.addEventListener('input', calcularTotal);
        });

        document.getElementById('tipo').addEventListener('change', calcularStatus);

        // === PHOTO ===
        function loadPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').src = e.target.result;
                    document.getElementById('photoPreview').style.display = 'block';
                    document.getElementById('photoPlaceholder').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        // === SAVE / LOAD ===
        function saveToLocal() {
            const data = {};
            document.querySelectorAll('input, select, textarea').forEach(function(el) {
                if (el.id) data[el.id] = el.value;
            });
            data._stress = stressAtual;
            data._injuries = injuries;
            data._photo = document.getElementById('photoPreview').src;
            localStorage.setItem('scar-ficha-padrao', JSON.stringify(data));
            alert('Ficha salva com sucesso!');
        }

        function loadFromLocal() {
            const saved = localStorage.getItem('scar-ficha-padrao');
            if (!saved) { alert('Nenhuma ficha salva encontrada.'); return; }
            const data = JSON.parse(saved);
            document.querySelectorAll('input, select, textarea').forEach(function(el) {
                if (el.id && data[el.id] !== undefined) el.value = data[el.id];
            });
            if (data._stress !== undefined) stressAtual = data._stress;
            if (data._injuries) {
                injuries.leve = data._injuries.leve || 0;
                injuries.grave = data._injuries.grave || 0;
                injuries.critica = data._injuries.critica || 0;
            }
            if (data._photo && data._photo !== '') {
                document.getElementById('photoPreview').src = data._photo;
                document.getElementById('photoPreview').style.display = 'block';
                document.getElementById('photoPlaceholder').style.display = 'none';
            }
            calcularStatus();
            alert('Ficha carregada!');
        }

        function clearForm() {
            if (!confirm('Limpar toda a ficha? Isso nao pode ser desfeito.')) return;
            document.querySelectorAll('input, select, textarea').forEach(function(el) {
                if (el.type === 'number') el.value = 0;
                else if (el.tagName === 'SELECT') el.selectedIndex = 0;
                else el.value = '';
            });
            stressAtual = 0;
            injuries.leve = 0;
            injuries.grave = 0;
            injuries.critica = 0;
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoPlaceholder').style.display = 'block';
            calcularStatus();
        }

        // Init
        calcularStatus();
    </script>
</body>
</html>